<!DOCTYPE html>
<html>

<head>
  <!-- =========================
       Homebrew Alpha Strike Hex Play Shot Solving Computer (S.A.T.O.R.)
       Main Calculator UI
       ========================= -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Homebrew Alpha Strike Hex Play Shot Solving Computer (S.A.T.O.R.)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.0/css/bulma.min.css">
  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
  <style>
    /* ====== Global Layout & Colors ====== */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      background-color: #2c2f34 !important; /* brighter neutral dark */
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    section.hero {
      flex: 1 0 auto;
    }
    /* ====== Footer Styling ====== */
    footer.footer-fixed-bottom {
      background-color: #2c2f34 !important;
      color: #fff !important;
      flex-shrink: 0;
      width: 100%;
      padding: 1rem 0 0.5rem 0;
      box-sizing: border-box;
    }
    footer.footer-fixed-bottom .content,
    footer.footer-fixed-bottom p,
    footer.footer-fixed-bottom .has-text-centered {
      color: #fff !important;
    }
    /* ====== Button Styling ====== */
    .button.is-black, .button.is-black.is-active, .button.is-black.is-inverted {
      background-color: #23272a !important;
      color: #fff !important;
      border: 1.5px solid #fff !important;
    }
    /* Attacker movement: custom vivid colors for default and inverted states */
    #Attacker .button {
      background-color: #fff !important;
      color: #23272a !important;
      border: 1.5px solid #23272a !important;
      transition: background 0.15s, color 0.15s, border 0.15s;
    }
    #Attacker .button.attacker-stationary {
      background-color: #00e676 !important; /* vivid green */
      color: #fff !important;
      border: 1.5px solid #00e676 !important;
    }
    #Attacker .button.attacker-jump {
      background-color: #ff1744 !important; /* vivid red */
      color: #fff !important;
      border: 1.5px solid #ff1744 !important;
    }
    #Attacker .button.is-inverted.attacker-stationary {
      background-color: #23272a !important;
      color: #00e676 !important;
      border: 1.5px solid #00e676 !important;
    }
    #Attacker .button.is-inverted.attacker-jump {
      background-color: #23272a !important;
      color: #ff1744 !important;
      border: 1.5px solid #ff1744 !important;
    }
    #Attacker .button.is-inverted {
      background-color: #23272a !important;
      color: #fff !important;
      border: 1.5px solid #fff !important;
    }
    /* ====== Reset Button: Silvery, 3D, and Interactive ====== */
    .sator-reset-btn {
      background: linear-gradient(90deg,#e0e0e0 0%,#bfc9d1 100%);
      color: #23272a;
      font-weight: 700;
      border: 2.5px solid #fff;
      border-radius: 2em;
      box-shadow: 0 3px 16px 0 rgba(180,180,180,0.22), 0 1.5px 0 #bfc9d1 inset;
      padding: 0.5em 1.8em;
      transition: box-shadow 0.18s, background 0.18s, color 0.18s, border 0.18s, transform 0.12s;
      letter-spacing: 0.04em;
      font-size: 1.15em;
      outline: none;
      position: relative;
    }
    .sator-reset-btn:active, .sator-reset-btn.is-active {
      background: linear-gradient(90deg, #bfc9d1 0%, #e0e0e0 100%);
      color: #23272a;
      border: 2.5px solid #23272a;
      box-shadow: 0 1.5px 6px 0 rgba(80,80,80,0.13), 0 0.5px 0 #fff inset;
      transform: translateY(2px) scale(0.98);
    }
    /* Range buttons: restore vivid backgrounds for Medium and Long, keep inverted state as before, and fix border alignment */
    #Range .button.is-success {
      background-color: #00c853 !important; /* vivid green */
      color: #fff !important;
      border: 1.5px solid #00c853 !important;
      box-shadow: none !important;
    }
    #Range .button.is-success.is-inverted {
      background-color: #23272a !important;
      color: #00c853 !important;
      border: 1.5px solid #00c853 !important;
      box-shadow: none !important;
    }
    #Range .button.is-link {
      background-color: #1976d2 !important; /* vivid blue */
      color: #fff !important;
      border: 1.5px solid #1976d2 !important;
      box-shadow: none !important;
    }
    #Range .button.is-link.is-inverted {
      background-color: #23272a !important;
      color: #1976d2 !important;
      border: 1.5px solid #1976d2 !important;
      box-shadow: none !important;
    }
    /* Range buttons: make unactuated 'short' button border same color as button (white) for uniformity */
    #Range .button.is-white {
      background-color: #fff !important;
      color: #23272a !important;
      border: 1.5px solid #fff !important;
      box-shadow: none !important;
    }
    #Range .button.is-white.is-inverted {
      background-color: #23272a !important;
      color: #fff !important;
      border: 1.5px solid #fff !important;
      box-shadow: none !important;
    }
    #Range .button {
      margin: 0 !important;
      box-shadow: none !important;
    }
    /* Manual Mod+ and Mod-: match Skill/TMM/Heat bar behavior */
    #manualModPlus .button.is-white, #manualModMinus .button.is-white {
      background-color: #fff !important;
      color: #23272a !important;
      border: 1.5px solid #23272a !important;
    }
    #manualModPlus .button.is-black, #manualModPlus .button.is-black.is-active,
    #manualModMinus .button.is-black, #manualModMinus .button.is-black.is-active {
      background-color: #23272a !important;
      color: #fff !important;
      border: 1.5px solid #fff !important;
    }
    /* Make left table wider and prevent label wrapping */
    #viewTable {
      background: #181a1b !important;
      border-radius: 10px;
      min-width: 220px;
      max-width: 320px;
      width: 100%;
      font-size: 1.02rem;
      color: #fff;
      margin: 0 auto;
      border-collapse: separate !important;
      border-spacing: 0;
      box-shadow: 0 2px 10px 0 rgba(0,0,0,0.13);
    }
    #viewTable th, #viewTable td {
      border-bottom: 1px solid #23272a !important;
      padding: 0.35em 0.5em !important;
      text-align: left;
      background: transparent !important;
      white-space: nowrap !important;
    }
    #viewTable th {
      color: #bfc9d1 !important;
      font-weight: 600;
      width: 60%;
    }
    #viewTable tr:last-child th, #viewTable tr:last-child td {
      border-bottom: none !important;
    }
    @media (max-width: 900px) {
      #mainNav {
        display: flex !important;
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.5rem !important;
      }
      #mainNav > .level-left, #mainNav > .level-right {
        min-width: 0 !important;
        width: 100% !important;
        flex: 1 1 100% !important;
        display: block !important;
      }
      #mainNav .level-item {
        width: 100% !important;
      }
    }
    #Target .attacker-jump {
      background-color: #ff1744 !important;
      color: #fff !important;
      border: 1.5px solid #ff1744 !important;
    }
    #Target .attacker-jump.is-inverted {
      background-color: #23272a !important;
      color: #ff1744 !important;
      border: 1.5px solid #ff1744 !important;
    }
    #Target .attacker-stationary {
      background-color: #00e676 !important;
      color: #fff !important;
      border: 1.5px solid #00e676 !important;
    }
    #Target .attacker-stationary.is-inverted {
      background-color: #23272a !important;
      color: #00e676 !important;
      border: 1.5px solid #00e676 !important;
    }
    #Target #targetAero .button.is-inverted {
      background-color: #23272a !important;
      color: #fff !important;
      border: 1.5px solid #fff !important;
    }
    #Target #targetAero .button.is-inverted[modvalue="1"] {
      color: #00c853 !important;
      border: 1.5px solid #00c853 !important;
    }
    #Target #targetAero .button.is-inverted[modvalue="2"] {
      color: #1976d2 !important;
      border: 1.5px solid #1976d2 !important;
    }
    #Target #targetAero .button.is-inverted[modvalue="-2"] {
      color: #ffab00 !important;
      border: 1.5px solid #ffab00 !important;
    }
    .section-title {
      font-size: 1.08em;
      font-weight: 700;
      color: #bfc9d1;
      margin: 0.7em 0 0.2em 0;
      letter-spacing: 0.01em;
    }
    /* ====== Attacker Heat Bar Styling ====== */
    #attackerHeat .button.is-black {
      background-color: #23272a !important;
      color: #fff !important;
      border: 1.5px solid #fff !important;
    }
    #attackerHeat .button.is-black.is-active {
      background-color: #23272a !important;
      color: #fff !important;
      border: 1.5px solid #fff !important;
    }
    #attackerHeat .button.is-white {
      background-color: #fff !important;
      color: #23272a !important;
      border: 1.5px solid #23272a !important;
    }
  </style>
</head>

<body>
  <!-- =========================
       S.A.T.O.R. Calculator UI
       ========================= -->
  <section class="hero">
    <h1 class="subtitle has-text-white-ter has-text-centered">
      Homebrew Alpha Strike Hex Play Shot Solving Computer (S.A.T.O.R.)
    </h1>
    <div class="container has-text-centered is-fluid is-marginless">
      <!-- ====== Tab Navigation ====== -->
      <div class="tabs is-boxed is-fullwidth">
        <div class="container">
          <ul>
            <li class="tab is-active" onclick="openTab(event,'Gunnery')"><a
                class="has-text-white-ter has-background-primary-dark">S.</a></li>
            <li class="tab has-text-warning-dark" onclick="openTab(event,'Attacker')"><a
                class="has-text-white-ter has-background-info-dark">A.</a></li>
            <li class="tab has-text-success-dark" onclick="openTab(event,'Target')"><a
                class="has-text-white-ter has-background-success-dark">T.</a></li>
            <li class="tab has-text-info-dark" onclick="openTab(event,'Other')"><a
                class="has-text-white-ter has-background-warning-dark">O.</a></li>
            <li class="tab has-text-link-dark" onclick="openTab(event,'Range')"><a
                class="has-text-white-ter has-background-danger-dark">R.</a></li>
          </ul>
        </div>
      </div>
      <nav class="level is-mobile" id="mainNav">
        <!-- ====== Left Table: Modifier Summary ====== -->
        <div class="level-left" style="margin-right:0; min-width: 220px; flex: 1 1 300px;">
          <div class="level-item" style="margin-right:0; width:100%;">
            <table class="table is-fullwidth" id="viewTable" style="word-break:break-word;">
              <tbody>
                <tr>
                  <th>Skill</th>
                  <td>0</td>
                </tr>
                <tr>
                  <th>Attacker Movement</th>
                  <td>0</td>
                </tr>
                <tr>
                  <th>Target Movement</th>
                  <td>0</td>
                </tr>
                <tr>
                  <th>Other</th>
                  <td>0</td>
                </tr>
                <tr>
                  <th>Range</th>
                  <td>0</td>
                </tr>
                <tr>
                  <th>TN</th>
                  <td>Auto</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <!-- ====== Right Controls: All Tabs ====== -->
        <div class="level-right" style="margin-left:0; min-width: 220px; flex: 1 1 300px;">
          <!-- ====== Gunnery Tab ====== -->
          <div id="Gunnery" class="content-tab">
            <p class="section-title">Skill Level</p>
            <p>
              <a class="button is-rounded is-small is-white" onclick="updateGunnery(event, 1);">1</a>
              <a class="button is-rounded is-small is-white" onclick="updateGunnery(event, 2);">2</a>
              <a class="button is-rounded is-small is-white" onclick="updateGunnery(event, 3);">3</a>
              <a class="button is-rounded is-small is-white" onclick="updateGunnery(event, 4);">4</a>
              <a class="button is-rounded is-small is-white" onclick="updateGunnery(event, 5);">5</a>
              <a class="button is-rounded is-small is-white" onclick="updateGunnery(event, 6);">6</a>
            </p>
          </div>
          <!-- ====== Attacker Tab ====== -->
          <div id="Attacker" class="content-tab" style="display:none">
            <p class="section-title">Attacker Movement</p>
            <p>
              <a class="button is-rounded is-small attacker-stationary"
                onclick="updateAttacker(event, 0, -1);">Stationary/Immobile</a>
              <a class="button is-rounded is-white is-small" onclick="updateAttacker(event, 1, 0);">Ground Movement
                (Walk/Run)</a>
              <a class="button is-rounded is-danger is-small attacker-jump" onclick="updateAttacker(event, 2, 2);">Jump</a>
            </p>
            <p class="section-title">Attacker Heat</p>
            <div class="buttons has-addons" id="attackerHeat">
              <div class="field is-grouped">
                <a class="button is-rounded is-small" onclick="updateAttackerHeatBar(event, 0, 0);" modValue=0>0</a>
                <a class="button is-rounded is-small" onclick="updateAttackerHeatBar(event, 1, 1);" modValue=1>1</a>
                <a class="button is-rounded is-small" onclick="updateAttackerHeatBar(event, 2, 2);" modValue=2>2</a>
                <a class="button is-rounded is-small" onclick="updateAttackerHeatBar(event, 3, 3);" modValue=3>3</a>
                <a class="button is-rounded is-small" onclick="updateAttackerHeatBar(event, 4, 4);" modValue=4>4</a>
              </div>
            </div>
          </div>
          <!-- ====== Target Tab ====== -->
          <div id="Target" class="content-tab" style="display:none">
            <p class="section-title">TMM</p>
            <div class="buttons has-addons is-right" id="targetBasic">
              <a class="button is-rounded is-small is-white" onclick="updateTargetBar(event, 0);">0</a>
              <a class="button is-rounded is-small is-white" onclick="updateTargetBar(event, 1);">1</a>
              <a class="button is-rounded is-small is-white" onclick="updateTargetBar(event, 2);">2</a>
              <a class="button is-rounded is-small is-white" onclick="updateTargetBar(event, 3);">3</a>
              <a class="button is-rounded is-small is-white" onclick="updateTargetBar(event, 4);">4</a>
              <a class="button is-rounded is-small is-white" onclick="updateTargetBar(event, 5);">5</a>
              <a class="button is-rounded is-small is-white" onclick="updateTargetBar(event, 6);">6</a>
            </div>
            <p class="section-title">Movement Type</p>
            <div class="buttons has-addons is-right" id="targetJumpImmobile" style="margin-bottom:0.5em;">
              <a class="button is-rounded is-small attacker-jump" style="border:1.5px solid #ff1744; background-color:#ff1744; color:#fff;" onclick="updateTargetJump(event);">Jump</a>
              <a class="button is-rounded is-small attacker-stationary" style="border:1.5px solid #00e676; background-color:#00e676; color:#fff;" onclick="updateTargetAdvanced(event, 0, -4);">Immobile</a>
            </div>
            <p class="section-title">Aerospace Movement</p>
            <div class="buttons has-addons is-right" id="targetAero">
              <a class="button is-rounded is-small is-white" onclick="updateTargetAero(event, 0, 1);" modValue=1>WIGE/VTOL +1</a>
              <a class="button is-rounded is-small is-white" onclick="updateTargetAero(event, 1, 2);" modValue=2>Fixed Wing +2</a>
              <a class="button is-rounded is-small is-white" onclick="updateTargetAero(event, 2, -2);" modValue=-2>Airborn Dropship -2</a>
            </div>
          </div>
          <!-- ====== Other Tab ====== -->
          <div id="Other" class="content-tab is-pulled-left" style="display:none">
            <div class="columns is-mobile">
              <div class="column is-narrow">
                <p class="section-title">Woods/Jungle Between</p>
                <div class="buttons has-addons" id="woodsBetween">
                  <div class="field is-grouped">
                    <a class="button is-rounded is-white is-small" onclick="updateOther(event, 'woodsBetween', 0, 1);"
                      modValue=1>Light ‹3</a>
                    <a class="button is-rounded is-white is-small" onclick="updateOther(event, 'woodsBetween', 1, 2);"
                      modValue=2>Heavy ‹2</a>
                  </div>
                </div>
              </div>
            </div>
            <div class="columns is-mobile">
              <div class="column is-narrow">
                <p class="section-title">Target Woods Among</p>
                <div class="buttons has-addons" id="woodsAmong">
                  <div class="field is-grouped">
                    <a class="button is-rounded is-white is-small" onclick="updateOther(event, 'woodsAmong', 0, 1);"
                      modValue=1>Light</a>
                    <a class="button is-rounded is-white is-small" onclick="updateOther(event, 'woodsAmong', 1, 2);"
                      modValue=2>Heavy</a>
                    <a class="button is-rounded is-white is-small" onclick="updateOther(event, 'woodsAmong', 2, 3);"
                      modValue=3>Ultra-Heavy</a>
                  </div>
                </div>
              </div>
            </div>
            <div class="columns is-mobile">
              <div class="column is-narrow">
                <p class="section-title">Terrain Cover</p>
                <div class="buttons has-addons" id="otherTerrain">
                  <div class="field is-grouped">
                    <a class="button is-rounded is-white is-small" onclick="updateOther(event, 'otherTerrain', 0, 1);"
                      modValue=1>Partial cover</a>
                    <a class="button is-rounded is-white is-small" onclick="updateOther(event, 'otherTerrain', 1, 1);"
                      modValue=1>Water Lv,1</a>
                  </div>
                </div>
              </div>
            </div>
            <div class="columns is-mobile">
              <div class="column is-narrow">
                <!-- <p class="has-text-white-ter">2nd target</p> -->
                <div class="buttons has-addons" id="seconderyTarget">
                  <div class="field is-grouped">
                    <!-- <a class="button is-white is-small" onclick="updateOther(event, 'seconderyTarget', 0, 1);" modValue=1>forward arc</a> -->
                    <!-- <a class="button is-white is-small" onclick="updateOther(event, 'seconderyTarget', 1, 2);" modValue=2>side or rear arc</a> -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- ====== Range Tab ====== -->
          <div id="Range" class="content-tab" style="display:none">
            <p class="section-title">Select Range (Classic)</p>
            <div class="buttons has-addons is-right">
              <a class="button is-rounded is-white is-small" onclick="updateRange(event, 0, 0);">Short</a>
              <a class="button is-rounded is-success is-small" onclick="updateRange(event, 1, 2);">Medium +2</a>
              <a class="button is-rounded is-link is-small" onclick="updateRange(event, 2, 4);">Long +4</a>
            </div>
            <p class="section-title">Select Range (EasyShot™)</p>
            <div class="buttons has-addons is-right">
              <a class="button is-rounded is-white is-small" onclick="updateRange(event, 3, 0);">Short</a>
              <a class="button is-rounded is-success is-small" onclick="updateRange(event, 4, 1);">Medium +1</a>
              <a class="button is-rounded is-link is-small" onclick="updateRange(event, 5, 2);">Long +2</a>
            </div>
            <p class="title is-1"><!-- White space for adjustment.--></p>
            <p class="section-title">Manual Mod +</p>
            <div class="buttons has-addons is-right" id="manualModPlus">
              <div class="field is-grouped">
                <a class="button is-rounded is-white is-small" onclick="updateManualModPlus(event, 0, 0);" modValue=0>+0</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModPlus(event, 1, 1);" modValue=1>+1</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModPlus(event, 2, 2);" modValue=2>+2</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModPlus(event, 3, 3);" modValue=3>+3</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModPlus(event, 4, 4);" modValue=4>+4</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModPlus(event, 5, 5);" modValue=5>+5</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModPlus(event, 6, 6);" modValue=6>+6</a>
              </div>
            </div>
            <p class="section-title">Manual Mod -</p>
            <div class="buttons has-addons is-right" id="manualModMinus">
              <div class="field is-grouped">
                <a class="button is-rounded is-white is-small" onclick="updateManualModMinus(event, 0, 0);" modValue=0>-0</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModMinus(event, 1, -1);" modValue=-1>-1</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModMinus(event, 2, -2);" modValue=-2>-2</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModMinus(event, 3, -3);" modValue=-3>-3</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModMinus(event, 4, -4);" modValue=-4>-4</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModMinus(event, 5, -5);" modValue=-5>-5</a>
                <a class="button is-rounded is-white is-small" onclick="updateManualModMinus(event, 6, -6);" modValue=-6>-6</a>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <!-- ====== Prominent Reset Button ====== -->
      <div id="resetButtonContainer" style="width:100%;display:flex;justify-content:center;align-items:center;margin-bottom:1.2rem;">
        <button id="resetSatorBtn" class="button is-medium sator-reset-btn" onclick="resetSator();">
          Reset
        </button>
        <button id="resetSatorSBtn" class="button is-medium sator-reset-btn" style="margin-left:1em;" onclick="resetSatorS();">
          Reset-S
        </button>
      </div>
    </div>
  </section>
  <!-- =========================
       Footer: Project Link & Version
       ========================= -->
  <footer class="footer-fixed-bottom">
    <div class="content has-text-centered">
      <p>
        Project homepage: <a href="https://github.com/n2tr0n/n2-alphastrike-tools" target="_blank" rel="noopener noreferrer" style="color:#bfc9d1; font-weight:600; font-size:1.08em; text-decoration:underline;">
          https://github.com/n2tr0n/n2-alphastrike-tools
        </a>
      </p>
      <p id="appVersion"></p>
    </div>
  </footer>
</body>
<script>
  // =========================
  // Version Display
  // =========================
  window.onload = function() {
    fetch('version.json')
      .then(response => response.json())
      .then(data => {
        var versionElem = document.getElementById('appVersion');
        if (versionElem) {
          versionElem.innerHTML = 'app version: ' + data.version;
        }
      });
    setDefaultAeroButtonColors();
  };

  // =========================
  // UI Logic & State Variables
  // =========================
  function openTab(evt, tabName) {
    var i, x, tablinks;
    x = document.getElementsByClassName("content-tab");
    for (i = 0; i < x.length; i++) {
      x[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tab");
    for (i = 0; i < x.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" is-active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " is-active";
  };

  function selectUntilNumberButton(evt, id, num) {
    var elem = document.getElementById(id);
    var buttons = elem.getElementsByClassName("button");
    // num is the value (1-6), so invert up to index num-1
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(" is-black", "");
      buttons[i].className = buttons[i].className.replace(" is-white", "");
      buttons[i].className = buttons[i].className.replace(" is-active", "");
      if (i < num) {
        buttons[i].className += " is-black is-active";
      } else {
        buttons[i].className += " is-white";
      }
    }
  }

  function selectButton(evt, id, num, eraseAttribute, selectAttribute) {
    var elem = document.getElementById(id);
    var buttons = elem.getElementsByClassName("button");
    eraseAttribute = eraseAttribute ? eraseAttribute : " is-inverted";
    selectAttribute = selectAttribute ? " " + selectAttribute : " is-inverted";
    for (i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(eraseAttribute, "");
    }
    buttons[num].className += selectAttribute;
    return selectAttribute;
  }

  function setTableValue(evt, id, row, col, value) {
    var elem = document.getElementById(id);
    elem.rows[row].cells[col].firstChild.data = value;
  }

  var manualModPlus = 0;
  var manualModMinus = 0;

  function sumModifierValue() {
    var elem = document.getElementById('viewTable');
    var sum = 0;
    // Sum Skill, Attacker, Target, Other, Range
    for (var i = 0; i <= 4; i++) {
      sum += Number(elem.rows[i].cells[1].firstChild.data);
    }
    // Add hidden manual mods
    sum += manualModPlus;
    sum += manualModMinus;

    // Write result to TN row (row 5)
    var tnRow = 5;
    if (sum <= 2) {
      sum = "Auto"
    }
    else if (sum >= 13) {
      sum = "No Chance";
    }
    else {
      sum = sum + "+";
    }
    setTableValue(event, 'viewTable', tnRow, 1, sum)
  }

  function updateGunnery(evt, num) {
    selectUntilNumberButton(evt, 'Gunnery', num);
    setTableValue(evt, 'viewTable', 0, 1, num);
    sumModifierValue();
  }

  function updateAttacker(evt, num, value) {
    // Invert only the selected movement button, remove from others
    var btns = document.getElementById('Attacker').getElementsByClassName('button');
    for (var i = 0; i < 3; i++) {
      btns[i].className = btns[i].className.replace(' is-inverted', '');
    }
    btns[num].className += ' is-inverted';
    // Store movement value
    window._attackerMovementValue = value;
    // Get heat value
    var heat = typeof window._attackerHeatValue === 'number' ? window._attackerHeatValue : 0;
    // Update Attacker row in table: movement + heat
    var table = document.getElementById('viewTable');
    table.rows[1].cells[1].firstChild.data = value + heat;
    sumModifierValue();
  }

  function updateTarget(evt, num) {
    selectButton(event, 'targetBasic', num);
    //If advanced is on, turn off advanced.
    var elem = document.getElementById('targetAdvanced');
    var buttons = elem.getElementsByClassName("button");
    for (i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(" is-inverted", "");
    }
    //If jump is on, add +1.
    elem = document.getElementById('targetJump');
    buttons = elem.getElementsByClassName("button");
    if (buttons[0].className.indexOf(" is-inverted") != -1) {
      num = num + 1;
    }
    setTableValue(event, 'viewTable', 2, 1, num)
    sumModifierValue();
  }
  function updateTargetBar(evt, num) {
    var elem = document.getElementById('targetBasic');
    var buttons = elem.getElementsByClassName('button');
    // If clicking an already-selected TMM button, deselect all
    if (buttons[num].className.indexOf(' is-black') !== -1) {
      for (var i = 0; i < buttons.length; i++) {
        buttons[i].className = buttons[i].className.replace(' is-black', '');
        buttons[i].className = buttons[i].className.replace(' is-active', '');
        buttons[i].className = buttons[i].className.replace(' is-white', '');
        buttons[i].className += ' is-white';
      }
      // Update table and sum
      updateTargetAeroSum();
      return;
    }
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(' is-black', '');
      buttons[i].className = buttons[i].className.replace(' is-white', '');
      buttons[i].className = buttons[i].className.replace(' is-active', '');
      if (i <= num) {
        buttons[i].className += ' is-black is-active';
      } else {
        buttons[i].className += ' is-white';
      }
    }
    //If advanced is on, turn off advanced.
    var advElem = document.getElementById('targetJumpImmobile');
    var advButtons = advElem.getElementsByClassName('button');
    for (i = 0; i < advButtons.length; i++) {
      advButtons[i].className = advButtons[i].className.replace(' is-inverted', '');
    }
    //If jump is on, add +1.
    var jumpImmobileElem = document.getElementById('targetJumpImmobile');
    var jumpImmobileBtns = jumpImmobileElem.getElementsByClassName('button');
    var tmm = num;
    if (jumpImmobileBtns[0].className.indexOf(' is-inverted') != -1) {
      tmm = tmm + 1;
    }
    // If Immobile is on, override with -4
    if (jumpImmobileBtns[1].className.indexOf(' is-inverted') != -1) {
      tmm = -4;
    }
    var table = document.getElementById('viewTable');
    table.rows[2].cells[1].firstChild.data = tmm;
    sumModifierValue();
  }
  function updateTargetJump(evt) {
    var elem = document.getElementById('targetJumpImmobile');
    var buttons = elem.getElementsByClassName('button');
    // Only toggle Jump
    if (buttons[0].className.indexOf(' is-inverted') !== -1) {
      buttons[0].className = buttons[0].className.replace(' is-inverted', '');
    } else {
      buttons[0].className += ' is-inverted';
      // Unselect Immobile if selected
      buttons[1].className = buttons[1].className.replace(' is-inverted', '');
    }
    // Update table logic as before
    var table = document.getElementById('viewTable');
    var tmm = Number(table.rows[2].cells[1].firstChild.data);
    if (buttons[0].className.indexOf(' is-inverted') !== -1) {
      table.rows[2].cells[1].firstChild.data = tmm + 1;
    } else {
      table.rows[2].cells[1].firstChild.data = tmm - 1;
    }
    sumModifierValue();
  }
  function updateTargetAdvanced(evt, num, value) {
    var elem = document.getElementById('targetJumpImmobile');
    var buttons = elem.getElementsByClassName('button');
    // Only toggle Immobile
    if (buttons[1].className.indexOf(' is-inverted') !== -1) {
      buttons[1].className = buttons[1].className.replace(' is-inverted', '');
      // When deselecting Immobile, do not touch TMM buttons
    } else {
      buttons[1].className += ' is-inverted';
      // Unselect Jump if selected
      buttons[0].className = buttons[0].className.replace(' is-inverted', '');
      // Unselect all TMM buttons when Immobile is pressed
      var tmmElem = document.getElementById('targetBasic');
      var tmmButtons = tmmElem.getElementsByClassName('button');
      for (var i = 0; i < tmmButtons.length; i++) {
        tmmButtons[i].className = tmmButtons[i].className.replace(' is-black', '');
        tmmButtons[i].className = tmmButtons[i].className.replace(' is-active', '');
        tmmButtons[i].className = tmmButtons[i].className.replace(' is-white', '');
        tmmButtons[i].className += ' is-white';
      }
    }
    // Update table logic as before
    var table = document.getElementById('viewTable');
    if (buttons[1].className.indexOf(' is-inverted') !== -1) {
      table.rows[2].cells[1].firstChild.data = value;
    } else {
      // If Immobile is deselected, recalculate TMM+Jump/Aero
      updateTargetAeroSum();
      return;
    }
    sumModifierValue();
  }

  // Track each 'Other' group value separately
  var otherWoodsBetween = 0;
  var otherWoodsAmong = 0;
  var otherTerrain = 0;

  // Track attacker heat separately
  var attackerHeat = 0;

  function updateAttackerHeatBar(evt, index, value) {
    // Fill-in/invert for all up to selected
    var elem = document.getElementById('attackerHeat');
    var buttons = elem.getElementsByClassName('button');
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(' is-black', '');
      buttons[i].className = buttons[i].className.replace(' is-white', '');
      buttons[i].className = buttons[i].className.replace(' is-active', '');
      if (i <= index) {
        buttons[i].className += ' is-black is-active';
      } else {
        buttons[i].className += ' is-white';
      }
    }
    window._attackerHeatValue = value;
    updateAttackerSum();
  }

  function updateAttackerSum() {
    var table = document.getElementById('viewTable');
    var movement = typeof window._attackerMovementValue === 'number' ? window._attackerMovementValue : 0;
    var heat = typeof window._attackerHeatValue === 'number' ? window._attackerHeatValue : 0;
    table.rows[1].cells[1].firstChild.data = movement + heat;
    sumModifierValue();
  }

  // Update updateAttacker to call updateAttackerSum
  function updateAttacker(evt, num, value) {
    // Invert only the selected movement button, remove from others
    var btns = document.getElementById('Attacker').getElementsByClassName('button');
    for (var i = 0; i < 3; i++) {
      btns[i].className = btns[i].className.replace(' is-inverted', '');
    }
    btns[num].className += ' is-inverted';
    // Store movement value
    window._attackerMovementValue = value;
    // Get heat value
    var heat = typeof window._attackerHeatValue === 'number' ? window._attackerHeatValue : 0;
    // Update Attacker row in table: movement + heat
    var table = document.getElementById('viewTable');
    table.rows[1].cells[1].firstChild.data = value + heat;
    sumModifierValue();
  }

  // Remove heat logic from Other panel
  function updateOther(evt, targetId, index, value) {
    // Get selected button index, and modValue.
    var elem = document.getElementById(targetId);
    var buttons = elem.getElementsByClassName("button");
    var subtractValue = 0;
    var unselect = false;
    var i = 0;
    for (i = 0; i < buttons.length; i++) {
      if (buttons[i].className.indexOf(" is-inverted") != -1) {
        subtractValue = Number(buttons[i].attributes.modValue.value);
        if (i == index) {
          unselect = true;
        }
      }
      buttons[i].className = buttons[i].className.replace(" is-inverted", "");
    }
    //If selected index equal parameter index, do unselect.
    var table = document.getElementById("viewTable");
    if (unselect) {
      table.rows[3].cells[1].firstChild.data = Number(table.rows[3].cells[1].firstChild.data) - subtractValue;
    }
    else {
      buttons[index].className += " is-inverted";
      table.rows[3].cells[1].firstChild.data = Number(table.rows[3].cells[1].firstChild.data) - subtractValue + value;
    }
    sumModifierValue();
  }

  // Remove heat from Other sum
  function updateOtherSum() {
    var table = document.getElementById('viewTable');
    table.rows[3].cells[1].firstChild.data = otherWoodsBetween + otherWoodsAmong + otherTerrain;
    sumModifierValue();
  }

  // --- RESET FUNCTIONALITY ---
  document.getElementById('resetSatorBtn').onclick = resetSator;
  function resetSator() {
    // Save current tab
    var tabEls = document.getElementsByClassName('tab');
    var activeTabIdx = 0;
    for (var i = 0; i < tabEls.length; i++) {
      if (tabEls[i].className.indexOf('is-active') !== -1) {
        activeTabIdx = i;
        break;
      }
    }
    // Reset all table values
    var table = document.getElementById('viewTable');
    table.rows[0].cells[1].firstChild.data = 0; // Skill
    table.rows[1].cells[1].firstChild.data = 0; // Attacker
    table.rows[2].cells[1].firstChild.data = 0; // Target
    table.rows[3].cells[1].firstChild.data = 0; // Other
    table.rows[4].cells[1].firstChild.data = 0; // Range
    table.rows[5].cells[1].firstChild.data = 'Auto'; // TN
    // Reset Skill bar
    selectUntilNumberButton(null, 'Gunnery', 0);
    // Reset Attacker: remove is-inverted from all, do NOT select any
    var attackerBtns = document.getElementById('Attacker').getElementsByClassName('button');
    for (var i = 0; i < 3; i++) {
      attackerBtns[i].className = attackerBtns[i].className.replace(' is-inverted', '');
    }
    window._attackerMovementValue = 0;
    // Reset Attacker Heat
    var heatBtns = document.getElementById('attackerHeat').getElementsByClassName('button');
    for (var i = 0; i < heatBtns.length; i++) {
      heatBtns[i].className = heatBtns[i].className.replace(' is-black', '');
      heatBtns[i].className = heatBtns[i].className.replace(' is-white', '');
      heatBtns[i].className = heatBtns[i].className.replace(' is-active', '');
      heatBtns[i].className = heatBtns[i].className.trim();
    }
    // Do not select any heat button after reset
    window._attackerHeatValue = 0;
    // Reset Target bar (TMM)
    selectUntilNumberButton(null, 'targetBasic', 0);
    // Reset Target Jump/Immobile
    var jumpImmobileBtns = document.getElementById('targetJumpImmobile').getElementsByClassName('button');
    for (var i = 0; i < jumpImmobileBtns.length; i++) {
      jumpImmobileBtns[i].className = jumpImmobileBtns[i].className.replace(' is-inverted', '');
    }
    // Reset Target Aerospace Movement
    var targetAeroBtns = document.getElementById('targetAero').getElementsByClassName('button');
    for (var i = 0; i < targetAeroBtns.length; i++) {
      targetAeroBtns[i].className = targetAeroBtns[i].className.replace(' is-inverted', '');
    }
    setDefaultAeroButtonColors();
    // Reset Other: woodsBetween
    var woodsBetweenBtns = document.getElementById('woodsBetween').getElementsByClassName('button');
    for (var i = 0; i < woodsBetweenBtns.length; i++) woodsBetweenBtns[i].className = woodsBetweenBtns[i].className.replace(' is-inverted', '');
    // Reset Other: woodsAmong
    var woodsAmongBtns = document.getElementById('woodsAmong').getElementsByClassName('button');
    for (var i = 0; i < woodsAmongBtns.length; i++) woodsAmongBtns[i].className = woodsAmongBtns[i].className.replace(' is-inverted', '');
    // Reset Other: otherTerrain
    var otherTerrainBtns = document.getElementById('otherTerrain').getElementsByClassName('button');
    for (var i = 0; i < otherTerrainBtns.length; i++) otherTerrainBtns[i].className = otherTerrainBtns[i].className.replace(' is-inverted', '');
    // Reset Attacker Heat
    selectUntilNumberButton(null, 'attackerHeat', 0);
    attackerHeat = 0;
    // Reset Range (both rows)
    var rangeBtns = document.getElementById('Range').getElementsByClassName('button');
    for (var i = 0; i < rangeBtns.length; i++) rangeBtns[i].className = rangeBtns[i].className.replace(' is-inverted', '');
    // Reset Manual Mod+
    selectUntilNumberButton(null, 'manualModPlus', 0);
    manualModPlus = 0;
    // Reset Manual Mod-
    selectUntilNumberButton(null, 'manualModMinus', 0);
    manualModMinus = 0;
    // Reset Other state vars
    otherWoodsBetween = 0;
    otherWoodsAmong = 0;
    otherTerrain = 0;
    attackerHeat = 0;
    // Recompute TN
    sumModifierValue();
    // Restore tab
    for (var i = 0; i < tabEls.length; i++) {
      tabEls[i].className = tabEls[i].className.replace(' is-active', '');
    }
    tabEls[activeTabIdx].className += ' is-active';
    var tabNames = ['Gunnery','Attacker','Target','Other','Range'];
    var contentTabs = document.getElementsByClassName('content-tab');
    for (var i = 0; i < contentTabs.length; i++) contentTabs[i].style.display = 'none';
    document.getElementById(tabNames[activeTabIdx]).style.display = 'block';
  }
  function resetSatorS() {
    resetSator();
    // Switch to S tab (Gunnery)
    var tabEls = document.getElementsByClassName('tab');
    var contentTabs = document.getElementsByClassName('content-tab');
    for (var i = 0; i < tabEls.length; i++) {
      tabEls[i].className = tabLs[i].className.replace(' is-active', '');
    }
    tabEls[0].className += ' is-active';
    for (var i = 0; i < contentTabs.length; i++) contentTabs[i].style.display = 'none';
    document.getElementById('Gunnery').style.display = 'block';
  }
  // Add visual feedback for button press
  var resetBtn = document.getElementById('resetSatorBtn');
  if (resetBtn) {
    resetBtn.addEventListener('mousedown', function() {
      resetBtn.classList.add('is-active');
    });
    resetBtn.addEventListener('mouseup', function() {
      resetBtn.classList.remove('is-active');
    });
    resetBtn.addEventListener('mouseleave', function() {
      resetBtn.classList.remove('is-active');
    });
    resetBtn.addEventListener('touchstart', function() {
      resetBtn.classList.add('is-active');
    });
    resetBtn.addEventListener('touchend', function() {
      resetBtn.classList.remove('is-active');
    });
  }
  var resetSBtn = document.getElementById('resetSatorSBtn');
  if (resetSBtn) {
    resetSBtn.addEventListener('mousedown', function() {
      resetSBtn.classList.add('is-active');
    });
    resetSBtn.addEventListener('mouseup', function() {
      resetSBtn.classList.remove('is-active');
    });
    resetSBtn.addEventListener('mouseleave', function() {
      resetSBtn.classList.remove('is-active');
    });
    resetSBtn.addEventListener('touchstart', function() {
      resetSBtn.classList.add('is-active');
    });
    resetSBtn.addEventListener('touchend', function() {
      resetSBtn.classList.remove('is-active');
    });
  }

  // --- Aerospace Movement Logic ---
  var targetAero = 0;
  function setDefaultAeroButtonColors() {
    var elem = document.getElementById('targetAero');
    if (!elem) return;
    var buttons = elem.getElementsByClassName('button');
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].style.backgroundColor = '';
      buttons[i].style.color = '';
      buttons[i].style.border = '';
      var mod = buttons[i].getAttribute('modValue');
      if (mod == '1') {
        buttons[i].style.backgroundColor = '#00c853';
        buttons[i].style.color = '#fff';
        buttons[i].style.border = '1.5px solid #00c853';
      } else if (mod == '2') {
        buttons[i].style.backgroundColor = '#1976d2';
        buttons[i].style.color = '#fff';
        buttons[i].style.border = '1.5px solid #1976d2';
      } else if (mod == '-2') {
        buttons[i].style.backgroundColor = '#ffab00';
        buttons[i].style.color = '#fff';
        buttons[i].style.border = '1.5px solid #ffab00';
      }
    }
  }
  function updateTargetAero(evt, index, value) {
    var elem = document.getElementById('targetAero');
    var buttons = elem.getElementsByClassName('button');
    // Only one button selectable: deselect all, then select clicked
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(' is-inverted', '');
      // Set base color for all (colored bg, white text, colored border)
      var mod = buttons[i].getAttribute('modValue');
      if (mod == '1') {
        buttons[i].style.backgroundColor = '#00c853';
        buttons[i].style.color = '#fff';
        buttons[i].style.border = '1.5px solid #00c853';
      } else if (mod == '2') {
        buttons[i].style.backgroundColor = '#1976d2';
        buttons[i].style.color = '#fff';
        buttons[i].style.border = '1.5px solid #1976d2';
      } else if (mod == '-2') {
        buttons[i].style.backgroundColor = '#ffab00';
        buttons[i].style.color = '#fff';
        buttons[i].style.border = '1.5px solid #ffab00';
      }
    }
    // If already selected, deselect all (toggle off)
    if (evt.currentTarget.className.indexOf(' is-inverted') !== -1) {
      targetAero = 0;
      updateTargetAeroSum();
      return;
    }
    // Select clicked button, apply inverted color
    buttons[index].className += ' is-inverted';
    if (value == 1) { // WIGE/VTOL +1 (green)
      buttons[index].style.backgroundColor = '#23272a';
      buttons[index].style.color = '#00c853';
      buttons[index].style.border = '1.5px solid #00c853';
    } else if (value == 2) { // Fixed Wing +2 (blue)
      buttons[index].style.backgroundColor = '#23272a';
      buttons[index].style.color = '#1976d2';
      buttons[index].style.border = '1.5px solid #1976d2';
    } else if (value == -2) { // Dropship -2 (amber)
      buttons[index].style.backgroundColor = '#23272a';
      buttons[index].style.color = '#ffab00';
      buttons[index].style.border = '1.5px solid #ffab00';
    }
    // Set value
    targetAero = value;
    updateTargetAeroSum();
  }
  function updateTargetAeroSum() {
    // Add TMM + Aero mods
    var tmm = 0;
    var tmmElem = document.getElementById('targetBasic');
    var tmmButtons = tmmElem.getElementsByClassName('button');
    for (var i = 0; i < tmmButtons.length; i++) {
      if (tmmButtons[i].className.indexOf(' is-black') !== -1) {
        tmm = i;
      }
    }
    // If Jump is on, add +1
    var jumpImmobileElem = document.getElementById('targetJumpImmobile');
    var jumpImmobileBtns = jumpImmobileElem.getElementsByClassName('button');
    if (jumpImmobileBtns[0].className.indexOf(' is-inverted') !== -1) {
      tmm = tmm + 1;
    }
    // If Immobile is on, override with -4
    if (jumpImmobileBtns[1].className.indexOf(' is-inverted') !== -1) {
      tmm = -4;
    }
    // Add aerospace movement
    var table = document.getElementById('viewTable');
    table.rows[2].cells[1].firstChild.data = tmm + targetAero;
    sumModifierValue();
  }
  // Patch updateTargetBar, updateTargetJump, updateTargetAdvanced to call updateTargetAeroSum
  // var orig_updateTargetBar = updateTargetBar;
  // updateTargetBar = function(evt, num) {
  //   orig_updateTargetBar(evt, num);
  //   updateTargetAeroSum();
  // }
  var orig_updateTargetJump = updateTargetJump;
  updateTargetJump = function(evt) {
    orig_updateTargetJump(evt);
    updateTargetAeroSum();
  }
  var orig_updateTargetAdvanced = updateTargetAdvanced;
  updateTargetAdvanced = function(evt, num, value) {
    orig_updateTargetAdvanced(evt, num, value);
    updateTargetAeroSum();
  }

  function updateRange(evt, num, value) {
    // There are 6 range buttons (3 classic, 3 easyshot), but only one can be selected at a time
    var rangePanel = document.getElementById('Range');
    var buttons = rangePanel.getElementsByClassName('button');
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(' is-inverted', '');
    }
    buttons[num].className += ' is-inverted';
    // Set value in table (row 4, col 1)
    var table = document.getElementById('viewTable');
    table.rows[4].cells[1].firstChild.data = value;
    sumModifierValue();
  }

  function updateManualModPlus(evt, num, value) {
    // Only one Manual Mod+ button can be selected at a time
    var elem = document.getElementById('manualModPlus');
    var buttons = elem.getElementsByClassName('button');
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(' is-black', '');
      buttons[i].className = buttons[i].className.replace(' is-white', '');
      buttons[i].className = buttons[i].className.replace(' is-active', '');
      if (i <= num) {
        buttons[i].className += ' is-black is-active';
      } else {
        buttons[i].className += ' is-white';
      }
    }
    manualModPlus = value;
    sumModifierValue();
  }

  function updateManualModMinus(evt, num, value) {
    // Only one Manual Mod- button can be selected at a time
    var elem = document.getElementById('manualModMinus');
    var buttons = elem.getElementsByClassName('button');
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].className = buttons[i].className.replace(' is-black', '');
      buttons[i].className = buttons[i].className.replace(' is-white', '');
      buttons[i].className = buttons[i].className.replace(' is-active', '');
      if (i <= num) {
        buttons[i].className += ' is-black is-active';
      } else {
        buttons[i].className += ' is-white';
      }
    }
    manualModMinus = value;
    sumModifierValue();
  }
</script>

</html>